<!-- The following code was made from an automatic builder tool the BlckScript team is working on (+ formatted by chatgpt), expect bugs. -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Generated Workspace</title>

    <!-- Load Blockly core -->
    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <!-- Load the default blocks -->
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <!-- Load a generator -->
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <!-- Load a message file -->
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <!-- English language -->

    <style>
      html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
      }

      #blocklyDiv {
        height: calc(100% - 40px);
        width: 100%;
      }

      #controls {
        height: 40px;
        padding: 5px;
        background-color: #eee;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div id="controls">
      <button onclick="runCode()">Run</button>
    </div>

    <div id="blocklyDiv"></div>

    <!-- Default Blockly Toolbox -->
    <xml id="toolbox" style="display: none">
      <category name="Logic" colour="%{BKY_LOGIC_HUE}">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" colour="%{BKY_LOOPS_HUE}">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math" colour="%{BKY_MATH_HUE}">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_round"></block>
        <block type="math_on_list"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain"></block>
        <block type="math_random_int"></block>
        <block type="math_random_float"></block>
        <block type="math_atan2"></block>
      </category>
      <category name="Text" colour="%{BKY_TEXTS_HUE}">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_length"></block>
        <block type="text_isEmpty"></block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring"></block>
        <block type="text_changeCase"></block>
        <block type="text_trim"></block>
        <block type="text_print"></block>
        <block type="text_prompt_ext"></block>
      </category>
      <category name="Lists" colour="%{BKY_LISTS_HUE}">
        <block type="lists_create_with"></block>
        <block type="lists_repeat"></block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf"></block>
        <block type="lists_getIndex"></block>
        <block type="lists_setIndex"></block>
        <block type="lists_getSublist"></block>
        <block type="lists_split"></block>
        <block type="lists_sort"></block>
        <block type="lists_reverse"></block>
      </category>
      <category name="Variables" custom="VARIABLE" colour="%{BKY_VARIABLES_HUE}"></category>
      <category name="Functions" custom="PROCEDURE" colour="%{BKY_PROCEDURES_HUE}"></category>
      <sep></sep>
      <category name="Generated Blocks">
        <block type="msg"></block>
      </category>
    </xml>

    <script>
      Blockly.Blocks['msg'] = {
        init: function () {
          this.appendDummyInput()
            .appendField("Test Block");
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(30);
          this.setTooltip("Custom Block!");
          this.setHelpUrl("");
        }
      };

      Blockly.JavaScript['msg'] = function (block) {
        return 'alert("This is a test, the block ID is: msg");\n';
      };

      // Inject workspace using the Zelos renderer
      const workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        renderer: 'zelos',
        grid: {
          spacing: 20,
          length: 3,
          colour: '#ccc',
          snap: true,
        },
        zoom: {
          controls: true,
          wheel: true,
          startScale: 1.0,
          maxScale: 3,
          minScale: 0.3,
          scaleSpeed: 1.2,
        },
        trashcan: true,
      });

      // Run the code from blocks
      function runCode() {
        try {
          const code = Blockly.JavaScript.workspaceToCode(workspace);
          console.log('Running:\n' + code);
          eval(code);
        } catch (e) {
          alert('Error: ' + e);
        }
      }
    </script>
  </body>
</html>
